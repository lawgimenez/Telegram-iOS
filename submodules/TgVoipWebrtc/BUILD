
objc_library(
    name = "TgVoipWebrtc",
    enable_modules = True,
    module_name = "TgVoipWebrtc",
    srcs = glob([
        "Sources/**/*.m",
        "Sources/**/*.mm",
        "Sources/**/*.h",
        "tgcalls/tgcalls/**/*.h",
        "tgcalls/tgcalls/**/*.cpp",
        "tgcalls/tgcalls/**/*.mm",
        "tgcalls/tgcalls/**/*.m",
    ], exclude = [
        "tgcalls/tgcalls/legacy/**",
        "tgcalls/tgcalls/platform/tdesktop/**",
        "tgcalls/tgcalls/platform/android/**",
        "tgcalls/tgcalls/platform/windows/**",
        "tgcalls/tgcalls/platform/darwin/VideoCameraCapturerMac.*",
        "tgcalls/tgcalls/platform/darwin/VideoMetalViewMac.*",
        "tgcalls/tgcalls/platform/darwin/GLVideoViewMac.*",
    ]),
    hdrs = glob([
        "PublicHeaders/**/*.h",
    ]),
    copts = [
        "-I{}/tgcalls/tgcalls".format(package_name()),
        "-Ithird-party/webrtc/webrtc-ios/src",
        "-Ithird-party/webrtc/webrtc-ios/src/third_party/abseil-cpp",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc/base",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc/components/renderer/metal",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc/components/renderer/opengl",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc/components/video_codec",
        "-Ithird-party/webrtc/webrtc-ios/src/third_party/libyuv/include",
        "-Ithird-party/webrtc/webrtc-ios/src/sdk/objc/api/video_codec",
        "-DWEBRTC_IOS",
        "-DWEBRTC_MAC",
        "-DWEBRTC_POSIX",
        "-DRTC_ENABLE_VP9",
        "-DTGVOIP_NAMESPACE=tgvoip_webrtc",
        "-std=c++14",
    ],
    includes = [
        "PublicHeaders",
    ],
    deps = [
        "//third-party/webrtc:webrtc_lib",
        "//submodules/MtProtoKit:MtProtoKit",
        "//submodules/openssl:openssl",
    ],
    sdk_frameworks = [
        "Foundation",
        "UIKit",
        "AudioToolbox",
        "VideoToolbox",
        "CoreTelephony",
        "CoreMedia",
        "AVFoundation",
    ],
    visibility = [
        "//visibility:public",
    ],
)
